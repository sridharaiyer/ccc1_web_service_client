HTTP/1.1 200 OK
Server: Apache
Last-Modified: Tue, 11 Jul 2017 17:05:05 GMT
Accept-Ranges: bytes
Content-Length: 11979
Content-Type: application/x-javascript
X-Pad: avoid browser bug
Cache-Control: max-age=172800
Date: Mon, 07 Aug 2017 20:05:44 GMT
Connection: keep-alive

//12/05/2016

window.onload = function() {
var currentDate = "?v=07112017";
function getParameterByName(name)
{
	  name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
	  var regexS = "[\\?&]" + name + "=([^&#]*)";
	  var regex = new RegExp(regexS);
	  var results = regex.exec(window.location.search);  
	  if(results == null)
		return "";
	  else
		return decodeURIComponent(results[1].replace(/\+/g, " "));
}








var srcLink = window.location.href;
if(srcLink.indexOf("dealerops.autotrader.int") > -1)
{
	var cssLink = "http://dealerops.autotrader.int/html5-GM-OEM-MNG/Templates/Chevy/chevy1n_OEM_MNG/Font/styles.css";
}else
{
	var cssLink = "//images.autotrader.com/images/dealerops/html5-GM-OEM-MNG/Templates/Chevy/chevy1n_OEM_MNG/Font/styles-images.css";
}


var fileref=document.createElement("link");
fileref.setAttribute("rel", "stylesheet");
fileref.setAttribute("type", "text/css");
//fileref.setAttribute("href", "http://www.autotrader.com/content/web/images/na/dmd/cadillac-oem-mng/218122.css");
fileref.setAttribute("href", cssLink);
document.getElementsByTagName("head")[0].appendChild(fileref);
				
				
	var elem = document.getElementById('mainCanvas');
	elem.style.cursor="pointer";
	elem.addEventListener('click', function(event) {
	navigate();
	});
	
	var version = detectIE();
if (version == true)
{
	if(window.frameElement == null)
	{
		var codeEle = document.createElement("code");
		codeEle.style.position = "absolute";
		codeEle.style.top = "0px";
		codeEle.style.left = "730px";
		codeEle.setAttribute("data-click-thru-url", getParameterByName("clickthruurl"));
		codeEle.setAttribute("data-dealer-name", getParameterByName("dealername"));
		codeEle.setAttribute("id", "codeData");
		document.body.appendChild(codeEle);
		var mainIframeCode = document.getElementById("codeData");
	}else
	{
		var mainIframeCode = window.frameElement;
	}
}else
{
	console.log("User in IE.");
	var codeEle = document.createElement("code");
	codeEle.style.position = "absolute";
	codeEle.style.top = "0px";
	codeEle.style.left = "730px";
	codeEle.setAttribute("data-click-thru-url", getParameterByName("clickthruurl"));
	codeEle.setAttribute("data-dealer-name", getParameterByName("dealername"));
	codeEle.setAttribute("id", "codeData");
	document.body.appendChild(codeEle);
	var mainIframeCode = document.getElementById("codeData");
}
	
	
	
	
	
	
	function navigate(){
		window.open(mainIframeCode.getAttribute("data-click-thru-url"), '_blank');
	}
		
	if (mainIframeCode.getAttribute("data-take-screen-shots") == "true")
	{
	var imgDomain = "http://dealerops.autotrader.int";
	}else
	{
	var imgDomain = "//images.autotrader.com/images/dealerops";
	}
	
	
	
	
	var dName = mainIframeCode.getAttribute("data-dealer-name");
	dName = dName.replace("<br></code>", "");
	dName = dName.replace("<br>", "");
	dName = dName.replace("</br>", "");
	dName = dName.replace("<br/>", "");
	
	
	/*var pDealerName = document.createElement("p");
	pDealerName.style.height = '14px';
	pDealerName.style.width = '200px';
	pDealerName.innerHTML = dName.toUpperCase();
	pDealerName.style.backgroundColor = '#FF0000';
	pDealerName.style.position = "absolute";
	pDealerName.style.top = "0px";
	pDealerName.style.left = "0px";
	pDealerName.style.fontFamily = "FuturaBT-Medium";
	pDealerName.style.fontSize = "12px";
	pDealerName.style.textAlign = "center";
	pDealerName.style.color = "#000000";
	pDealerName.style.cursor = "Pointer";
	pDealerName.onclick = navigate;
	document.body.appendChild(pDealerName);*/
	
		var postData, totalImages = 0, totalScreenShots = 4;
        var stage = new createjs.Stage("mainCanvas");
		var fnrLogo = new createjs.Bitmap(imgDomain+"/html5-GM-OEM-MNG/Templates/Chevy/chevy1n_OEM_MNG/fnr.png"+currentDate);
		var chevyLogo = new createjs.Bitmap(imgDomain+"/html5-GM-OEM-MNG/Templates/Chevy/chevy1n_OEM_MNG/chevy-logo.png"+currentDate);
        var bg = new createjs.Bitmap(imgDomain+"/html5-GM-OEM-MNG/Templates/Chevy/chevy1n_OEM_MNG/bg.jpg"+currentDate);
		var text1 = new createjs.Bitmap(imgDomain+"/html5-GM-OEM-MNG/Templates/Chevy/chevy1n_OEM_MNG/1.png");
		var text2 = new createjs.Bitmap(imgDomain+"/html5-GM-OEM-MNG/Templates/Chevy/chevy1n_OEM_MNG/2.png");
		var text3 = new createjs.Bitmap(imgDomain+"/html5-GM-OEM-MNG/Templates/Chevy/chevy1n_OEM_MNG/3.png");
		var disclaimerText = new createjs.Bitmap(imgDomain+"/html5-GM-OEM-MNG/Templates/Chevy/chevy1n_OEM_MNG/dis.jpg");
		//var pTagDname = new createjs.DOMElement(pDealerName);
		
		var pTagDname = new createjs.Text(dName.toUpperCase(), "12px Louis-Regular", "#ffffff");
		pTagDname.textAlign = "left";
		pTagDname.lineWidth = 150;
		//pTagDname.lineHeight = 50;
		pTagDname.x = 482;
		pTagDname.y = 4;
		/*pTagDname.scaleX=.7;
		pTagDname.scaleY=.7;*/
		
        bg.x = text1.x = text2.x = text3.x = disclaimerText.x = 0;
        bg.y = text1.y = text2.y = text3.y = disclaimerText.y = 0;
		
		fnrLogo.x = 616;
		fnrLogo.y = 22;
		chevyLogo.x = 626;
		chevyLogo.y = 7;

		bg.alpha = fnrLogo.alpha = chevyLogo.alpha = pTagDname.alpha = text1.alpha = text2.alpha = text3.alpha = disclaimerText.alpha = 0;
		
        stage.addChild(bg,fnrLogo,chevyLogo,pTagDname,text1,text2,text3,disclaimerText);
		
		loopLogos();
		function loopLogos()
		{
		createjs.Tween.get(fnrLogo, {loop: false})
		.to({alpha: 1}, 500, createjs.Ease.getPowInOut(2))
		//.call(handleComplete)
		.wait(1000)
		.to({alpha: 0}, 500, createjs.Ease.getPowInOut(2)),
		createjs.Tween.get(chevyLogo, {loop: false})
		.wait(2000)
		.to({alpha: 1}, 500, createjs.Ease.getPowInOut(2))
		//.call(handleComplete)
		.wait(1000)
		.to({alpha: 0}, 500, createjs.Ease.getPowInOut(2))
		.call(loopLogos);
		}


		stage.on("stagemousemove", function(evt) {
			console.log("stageX: "+evt.stageX + " stageY: "+evt.stageY);
			if(evt.stageX >= 560 && evt.stageX <= 612 && evt.stageY <= 74 )
			{
				createjs.Tween.get(disclaimerText, {loop: false,override:true}).to({alpha: 1}, 300, createjs.Ease.getPowInOut(2));
			}else
			{
				createjs.Tween.get(disclaimerText, {loop: false,override:true}).to({alpha: 0}, 300, createjs.Ease.getPowInOut(2));
			}
		});

		var tl = new createjs.Timeline(); //create the Timeline
        tl.addTween(
		createjs.Tween.get(bg, {loop: false})
		.to({alpha: 1, y: 0}, 1000, createjs.Ease.getPowInOut(2)),
		createjs.Tween.get(text1, {loop: false})
		.to({alpha: 1}, 1000, createjs.Ease.getPowInOut(2))
		.call(handleComplete)
		.wait(4000)
		.to({alpha: 0}, 1000, createjs.Ease.getPowInOut(2)),
		createjs.Tween.get(text2, {loop: false})
		.wait(5000)
		.to({alpha: 1}, 1000, createjs.Ease.getPowInOut(2))
		.call(handleComplete)
		.wait(3000)
		.to({alpha: 0}, 1000, createjs.Ease.getPowInOut(2)),
		createjs.Tween.get(text3, {loop: false})
		.wait(10000)
		.to({alpha: 1}, 1000, createjs.Ease.getPowInOut(2)),
		createjs.Tween.get(pTagDname, {loop: false})
		.wait(10000)
		.to({alpha: 1}, 1000, createjs.Ease.getPowInOut(2))
		.call(handleComplete)
		);

        createjs.Ticker.setFPS(60);
        createjs.Ticker.addEventListener("tick", stage);
		
		function restartAnimation() {
		tl.gotoAndPlay(1000);
		}
		
   		function handleComplete() {

							
							
		if (mainIframeCode.getAttribute("data-take-screen-shots") == "true")
		{
			var canvas = document.getElementById("mainCanvas");
			var ctx = canvas.getContext("2d");
			var dealerN = mainIframeCode.getAttribute("data-dealer-name");
			if(totalImages != totalScreenShots)
			{
				postData = {
				img: canvas.toDataURL("image/png"),
				templateName:"chevy1n_OEM_MNG",
				dealerName:dealerN.replace("&", "andand"),
				currentImage:++totalImages,
				totalImages:totalScreenShots,
				totalAds:mainIframeCode.getAttribute("data-total-ads"),
				thisAdNum:mainIframeCode.getAttribute("data-this-ad-number"),
				dealerId:mainIframeCode.getAttribute("data-dealer-id"),
				adType:mainIframeCode.getAttribute("data-ad-types"),
				makeName:mainIframeCode.getAttribute("data-make-name"),
				oneDocument:mainIframeCode.getAttribute("data-one-document"),
				clickThruUrl:mainIframeCode.getAttribute("data-click-thru-url")
				//totalImages: 1,
				//tcurrentImage: 1,
				};
				doRequest("http://dealerops.autotrader.int/List/Creative_Brief_Creator_OEM_MNG/Auto-Creative-Brief-html5/processData.cfm");
			}else
			{
				//parent.runProcess(mainIframeCode.getAttribute("data-total-ads"),mainIframeCode.getAttribute("data-dealer-id"));
			}
		}
		//doRequest("http://dealerops.autotrader.int/New-Catt/processData.cfm");
    }

function doRequest(url) {

    // Create the XHR object.
    var xhr = new XMLHttpRequest();
    if ("withCredentials" in xhr) {
        xhr.open('post', url, true);
		xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
	    xhr.send("formdata=" + JSON.stringify(postData));
		xhr.onreadystatechange = reportStatus;

    }else if(typeof XDomainRequest != "undefined") {
		
        xhr = new XDomainRequest();
        xhr.open('post', url);
		xhr.send(JSON.stringify(postData));
		
		var xmlhttp=new XMLHttpRequest();

		xhr.onerror = err;
        xhr.ontimeout = timeo;
        xhr.onprogress = progres;
        xhr.onload = loadd;
        xhr.timeout = tbTO.value;

    }else{
        xhr = null;
    }

    if (!xhr) {
        return;
    }
	
	function reportStatus()
			{
				
				if (xhr.readyState == 4) {//complete
					if (xhr.status == 200 || xhr.status == 304) {
						//document.body.innerHTML += xhr.responseText;

						if (xhr.responseText.trim() == "load next")
						{
						console.log(xhr.responseText.trim());
						parent.fromHtml5("done");
						//parent.runProcess(mainIframeCode.getAttribute("data-total-ads"),mainIframeCode.getAttribute("data-dealer-id"),mainIframeCode.getAttribute("data-dealer-name"));
						}
						else if (xhr.responseText.trim() == "continue")
						{
						console.log(xhr.responseText.trim());
						
						var showDis = totalImages + 1;
						if(showDis == totalScreenShots)
						{
							//createjs.Tween.get(disclaimerText, {loop: false,override:true}).to({alpha: 1}, 0, createjs.Ease.getPowInOut(2));
							
							createjs.Tween.get(disclaimerText)
								 .to({alpha:1}, 500)
								 .wait(1000)
								 .call(hComplete);
							function hComplete() {
								handleComplete();
							}
						}
						}else
						{
						console.log(xhr.responseText.trim());
						document.body.innerHTML = "";
						parent.fromHtml5(xhr.responseText);
						//alert(xhr.responseText);
						}
					}
					else {
						//alert('Error!');
					}
				}
			}
			
    //for IE:
    function err()
    {
      //alert("XDR onerror");
    }

    function timeo()
    {
      //alert("XDR ontimeout");
    }

    function loadd()
    {
      //readdata();
    }

    function progres()
    {
      //alert("XDR onprogress");
      //alert("Got: " + xhr.responseText);
    }

    function stopdata()
    {
      //xhr.abort();
    }
}      

// Get IE or Edge browser version
	var version = detectIE();
	
	function detectIE() {
	  var ua = window.navigator.userAgent;
	
	  var msie = ua.indexOf('MSIE ');
	  if (msie > 0) {
		// IE 10 or older => return version number
		return parseInt(ua.substring(msie + 5, ua.indexOf('.', msie)), 10);
	  }
	
	  var trident = ua.indexOf('Trident/');
	  if (trident > 0) {
		// IE 11 => return version number
		var rv = ua.indexOf('rv:');
		return parseInt(ua.substring(rv + 3, ua.indexOf('.', rv)), 10);
	  }
	
	  var edge = ua.indexOf('Edge/');
	  if (edge > 0) {
		// Edge (IE 12+) => return version number
		return parseInt(ua.substring(edge + 5, ua.indexOf('.', edge)), 10);
	  }
	
	  // other browser
	  return true;
	}     
};